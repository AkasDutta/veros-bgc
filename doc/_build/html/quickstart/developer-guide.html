

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Custom rules and tracers &mdash; Veros-BGC 0+untagged.3.gb2fcfb2.dirty documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Setup gallery" href="../reference/setup-gallery.html" />
    <link rel="prev" title="Basic usage" href="user-guide.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Veros-BGC
          

          
          </a>

          
            
            
              <div class="version">
                0+untagged.3.gb2fcfb2.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="user-guide.html">Basic usage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Custom rules and tracers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tracer-classes">Tracer classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#predefined-tracers">Predefined tracers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#base-tracer">Base tracer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#recyclable-tracer">Recyclable tracer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plankton">Plankton</a></li>
<li class="toctree-l4"><a class="reference internal" href="#phytoplankton">Phytoplankton</a></li>
<li class="toctree-l4"><a class="reference internal" href="#zooplankton">Zooplankton</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#extending-tracers">Extending tracers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rules">Rules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#optional-arguments">Optional arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#difference-between-rules-and-tracer-classes">Difference between rules and tracer classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#activation">Activation</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/setup-gallery.html">Setup gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/settings.html">Available model settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/variables.html">Available variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/diagnostics.html">Biogeochemistry Diagnostic</a></li>
</ul>
<p class="caption"><span class="caption-text">More Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/team-ocean/veros-bgc">Visit us on GitHub</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Veros-BGC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Custom rules and tracers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/quickstart/developer-guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="custom-rules-and-tracers">
<h1>Custom rules and tracers<a class="headerlink" href="#custom-rules-and-tracers" title="Permalink to this headline">¶</a></h1>
<p>The biogeochemistry module for Veros is designed for allowing construction of user defined ecosystems.
Base systems are made available for a basic Nutrients-Plankton-Zooplankton-Detritus, NPZD, system,
which can optionally be extended by a basic carbon cycle. Enabling the biogeochemistry module and
activating the basic NPZD system can be done by setting <code class="xref py py-attr docutils literal notranslate"><span class="pre">enable_npzd</span> <span class="pre">=</span> <span class="pre">True</span></code>.</p>
<p>Ecosystems created with the biogeochemistry module are extensible and any components of them are
in principle replaceable. This is handled by three principles: Representation of model tracers by classes,
representation of interactions between tracers as rules, and separation of component creation from activation.</p>
<div class="section" id="tracer-classes">
<h2>Tracer classes<a class="headerlink" href="#tracer-classes" title="Permalink to this headline">¶</a></h2>
<p>All model tracers in the biogeochemistry module are created as instances of classes inheriting from a
base class <code class="xref py py-class docutils literal notranslate"><span class="pre">NPZD_tracer</span></code>. This class itself inherits from numpy.ndarray, which allows using it
like any other Veros variable. The concentration (or appropriate unit) of the tracer within each cell
in Veros’ grid is stored in the corresponding cell in the tracer grid. The base class defines attributes
for operations which may apply to any tracer.</p>
<p>Instances of this class must be created with a numpy array backing the tracer values. Preferably this
array was created in variables.py. Additionally a name must be supplied. This name will uniquely
identify the tracer during simulation. Optional arguments may be supplied:
<code class="xref py py-attr docutils literal notranslate"><span class="pre">transport</span></code> By default this value is True. When <code class="xref py py-attr docutils literal notranslate"><span class="pre">transport</span></code> is true, the tracer is transported
according to the selected transportation scheme. Setting a value for for <code class="xref py py-attr docutils literal notranslate"><span class="pre">sinking_speed</span></code> will cause
the tracer to be included in calculations of sinking tracers. And setting <code class="xref py py-attr docutils literal notranslate"><span class="pre">light_attenuation</span></code> will
block downward shortwave radiation proportionally to the concentration of the tracer.
This class may itself be used for tracers, which should not express any further features such
as the nutrients phosphate.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NPZD_tracer</span><span class="p">(</span><span class="n">vs</span><span class="o">.</span><span class="n">po4</span><span class="p">,</span> <span class="s1">&#39;po4&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Tracers which should express actionable features such as grazing, primary production must implement
certain methods. Methods to implement are <code class="xref py py-attr docutils literal notranslate"><span class="pre">mortality</span></code> for mortality, <code class="xref py py-attr docutils literal notranslate"><span class="pre">recycle</span></code> for recycling,
<code class="xref py py-attr docutils literal notranslate"><span class="pre">potential_growth</span></code> for primary production. In addition to this methods should be supplied a list
of functions representing limiting in growth by nutrients. <code class="xref py py-attr docutils literal notranslate"><span class="pre">grazing</span></code> for grazing. This method
should return dictionaries for grazing, digestion, excretion, and sloppy feeding. Where the keys
are names of the tracers, which have been grazed upon.
It is possible to add additional actionable methods by editing npzd.py.</p>
<div class="section" id="predefined-tracers">
<h3>Predefined tracers<a class="headerlink" href="#predefined-tracers" title="Permalink to this headline">¶</a></h3>
<p>A number of classes for tracers have been predefined. These classes can be instantiated with different
parameters to defined tracers with varying properties. For example creating tracers for coccolithophores
and phytoplankton can be done like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">coccolithophores</span> <span class="o">=</span> <span class="n">Phytoplankton</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="n">vs</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="n">vs</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="n">vs</span><span class="o">.</span><span class="n">nz</span><span class="p">)),</span> <span class="s1">&#39;coccolithophores&#39;</span><span class="p">,</span>
                                 <span class="n">light_attenuation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                 <span class="n">growth_parameter</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                                 <span class="n">recycling_rate</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                                 <span class="n">mortality_rate</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>



<span class="n">phytoplankton</span> <span class="o">=</span> <span class="n">Phytoplankton</span><span class="p">(</span><span class="n">vs</span><span class="o">.</span><span class="n">phytoplankton</span><span class="p">,</span> <span class="s1">&#39;phytoplankton&#39;</span><span class="p">,</span>
                              <span class="n">light_attenuation</span><span class="o">=</span><span class="n">vs</span><span class="o">.</span><span class="n">light_attenuation_phytoplankton</span><span class="p">,</span>
                              <span class="n">growth_parameter</span><span class="o">=</span><span class="n">vs</span><span class="o">.</span><span class="n">maximum_growth_rate_phyto</span><span class="p">,</span>
                              <span class="n">recycling_rate</span><span class="o">=</span><span class="n">vs</span><span class="o">.</span><span class="n">fast_recycling_rate_phytoplankton</span><span class="p">,</span>
                              <span class="n">mortality_rate</span><span class="o">=</span><span class="n">vs</span><span class="o">.</span><span class="n">specific_mortality_phytoplankton</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="base-tracer">
<h4>Base tracer<a class="headerlink" href="#base-tracer" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="veros_bgc.core.npzd_tracers.NPZD_tracer">
<em class="property">class </em><code class="descclassname">veros_bgc.core.npzd_tracers.</code><code class="descname">NPZD_tracer</code><a class="reference internal" href="../_modules/veros_bgc/core/npzd_tracers.html#NPZD_tracer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#veros_bgc.core.npzd_tracers.NPZD_tracer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></p>
<p>Class for npzd tracers to store additional information about themselves.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Inhenrits from numpy.ndarray to make it work seamless with array operations</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_array</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Numpy array backing data</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – Identifier for the tracer, which must be unique within a given configuration</p></li>
<li><p><strong>sinking_speed</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>, optional) – Numpy array for how fast the tracer sinks in each cell</p></li>
<li><p><strong>transport</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a> = True, optional) – Whether or not to include the tracer in physical transport</p></li>
<li><p><strong>light_attenuation</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>, optional) – Factor for how much light is blocked</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="veros_bgc.core.npzd_tracers.NPZD_tracer.name">
<code class="descname">name</code><a class="headerlink" href="#veros_bgc.core.npzd_tracers.NPZD_tracer.name" title="Permalink to this definition">¶</a></dt>
<dd><p>Identifier for the tracer, which must be unique within a given configuration</p>
</dd></dl>

<dl class="attribute">
<dt id="veros_bgc.core.npzd_tracers.NPZD_tracer.description">
<code class="descname">description</code><a class="headerlink" href="#veros_bgc.core.npzd_tracers.NPZD_tracer.description" title="Permalink to this definition">¶</a></dt>
<dd><p>Description of the tracer represented by the class</p>
</dd></dl>

<dl class="attribute">
<dt id="veros_bgc.core.npzd_tracers.NPZD_tracer.transport">
<code class="descname">transport</code><a class="headerlink" href="#veros_bgc.core.npzd_tracers.NPZD_tracer.transport" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether or not to include the tracer in physical transport</p>
</dd></dl>

<dl class="attribute">
<dt id="veros_bgc.core.npzd_tracers.NPZD_tracer.sinking_speed">
<code class="descname">sinking_speed</code><a class="headerlink" href="#veros_bgc.core.npzd_tracers.NPZD_tracer.sinking_speed" title="Permalink to this definition">¶</a></dt>
<dd><p>If set: how fast the tracer sinks in each cell</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="veros_bgc.core.npzd_tracers.NPZD_tracer.light_attenuation">
<code class="descname">light_attenuation</code><a class="headerlink" href="#veros_bgc.core.npzd_tracers.NPZD_tracer.light_attenuation" title="Permalink to this definition">¶</a></dt>
<dd><p>If set: Factor for how much light is blocked</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>, optional</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="recyclable-tracer">
<h4>Recyclable tracer<a class="headerlink" href="#recyclable-tracer" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="veros_bgc.core.npzd_tracers.Recyclable_tracer">
<em class="property">class </em><code class="descclassname">veros_bgc.core.npzd_tracers.</code><code class="descname">Recyclable_tracer</code><a class="reference internal" href="../_modules/veros_bgc/core/npzd_tracers.html#Recyclable_tracer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#veros_bgc.core.npzd_tracers.Recyclable_tracer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#veros_bgc.core.npzd_tracers.NPZD_tracer" title="veros_bgc.core.npzd_tracers.NPZD_tracer"><code class="xref py py-class docutils literal notranslate"><span class="pre">veros_bgc.core.npzd_tracers.NPZD_tracer</span></code></a></p>
<p>A recyclable tracer</p>
<p>This would be tracer, which may be a tracer like detritus, which can be recycled</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_array</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Numpy array backing data</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – Identifier for the tracer, which must be unique within a given configuration</p></li>
<li><p><strong>recycling_rate</strong> – A factor scaling the recycling by the population size</p></li>
<li><p><strong>**kwargs</strong> – All named parameters accepted by super class</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="veros_bgc.core.npzd_tracers.Recyclable_tracer.recycling_rate">
<code class="descname">recycling_rate</code><a class="headerlink" href="#veros_bgc.core.npzd_tracers.Recyclable_tracer.recycling_rate" title="Permalink to this definition">¶</a></dt>
<dd><p>A factor scaling the recycling by the population size</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">+ All attributes held by super class</code></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="plankton">
<h4>Plankton<a class="headerlink" href="#plankton" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="veros_bgc.core.npzd_tracers.Plankton">
<em class="property">class </em><code class="descclassname">veros_bgc.core.npzd_tracers.</code><code class="descname">Plankton</code><a class="reference internal" href="../_modules/veros_bgc/core/npzd_tracers.html#Plankton"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#veros_bgc.core.npzd_tracers.Plankton" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#veros_bgc.core.npzd_tracers.Recyclable_tracer" title="veros_bgc.core.npzd_tracers.Recyclable_tracer"><code class="xref py py-class docutils literal notranslate"><span class="pre">veros_bgc.core.npzd_tracers.Recyclable_tracer</span></code></a></p>
<p>Class for plankton object, which is both recyclable and displays mortality</p>
<p>This class is intended as a base for phytoplankton and zooplankton and not
as a standalone class</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Typically, it would desirable to also set light attenuation</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_array</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Numpy array backing data</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – Identifier for the tracer, which must be unique within a given configuration</p></li>
<li><p><strong>mortality_rate</strong> – Rate at which the tracer is dying in mortality method</p></li>
<li><p><strong>**kwargs</strong> – All named parameters accepted by super class</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="veros_bgc.core.npzd_tracers.Plankton.mortality_rate">
<code class="descname">mortality_rate</code><a class="headerlink" href="#veros_bgc.core.npzd_tracers.Plankton.mortality_rate" title="Permalink to this definition">¶</a></dt>
<dd><p>Rate at which the tracer is dying in mortality method</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">+ All attributes held by super class</code></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="phytoplankton">
<h4>Phytoplankton<a class="headerlink" href="#phytoplankton" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="veros_bgc.core.npzd_tracers.Phytoplankton">
<em class="property">class </em><code class="descclassname">veros_bgc.core.npzd_tracers.</code><code class="descname">Phytoplankton</code><a class="reference internal" href="../_modules/veros_bgc/core/npzd_tracers.html#Phytoplankton"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#veros_bgc.core.npzd_tracers.Phytoplankton" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#veros_bgc.core.npzd_tracers.Plankton" title="veros_bgc.core.npzd_tracers.Plankton"><code class="xref py py-class docutils literal notranslate"><span class="pre">veros_bgc.core.npzd_tracers.Plankton</span></code></a></p>
<p>Phytoplankton also has primary production</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_array</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Numpy array backing data</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – Identifier for the tracer, which must be unique within a given configuration</p></li>
<li><p><strong>growth_parameter</strong> – Scaling factor for maximum potential growth</p></li>
<li><p><strong>**kwargs</strong> – All named parameters accepted by super class</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="veros_bgc.core.npzd_tracers.Phytoplankton.growth_parameter">
<code class="descname">growth_parameter</code><a class="headerlink" href="#veros_bgc.core.npzd_tracers.Phytoplankton.growth_parameter" title="Permalink to this definition">¶</a></dt>
<dd><p>Scaling factor for maximum potential growth</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">+ All attributes held by super class</code></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="zooplankton">
<h4>Zooplankton<a class="headerlink" href="#zooplankton" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="veros_bgc.core.npzd_tracers.Zooplankton">
<em class="property">class </em><code class="descclassname">veros_bgc.core.npzd_tracers.</code><code class="descname">Zooplankton</code><a class="reference internal" href="../_modules/veros_bgc/core/npzd_tracers.html#Zooplankton"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#veros_bgc.core.npzd_tracers.Zooplankton" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#veros_bgc.core.npzd_tracers.Plankton" title="veros_bgc.core.npzd_tracers.Plankton"><code class="xref py py-class docutils literal notranslate"><span class="pre">veros_bgc.core.npzd_tracers.Plankton</span></code></a></p>
<p>Zooplankton displays quadratic mortality rate but otherwise is similar to ordinary phytoplankton</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_array</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Numpy array backing data</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – Identifier for the tracer, which must be unique within a given configuration</p></li>
<li><p><strong>max_grazing</strong> – Scaling factor for maximum grazing rate</p></li>
<li><p><strong>grazing_saturation_constant</strong> – Saturation in Michaelis-Menten</p></li>
<li><p><strong>grazing_preferences</strong> – Dictionary of preferences for grazing on other tracers</p></li>
<li><p><strong>assimilation_efficiency</strong> – Fraction of grazed material ingested</p></li>
<li><p><strong>growth_efficiency</strong> – Fraction of ingested material resulting in growth</p></li>
<li><p><strong>maximum_growth_temperature</strong> (<em>= 20</em>) – Temperature in Celsius where increasing temperature no longer increases grazing</p></li>
<li><p><strong>**kwargs</strong> – All named parameters accepted by super class</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="veros_bgc.core.npzd_tracers.Zooplankton.max_grazing">
<code class="descname">max_grazing</code><a class="headerlink" href="#veros_bgc.core.npzd_tracers.Zooplankton.max_grazing" title="Permalink to this definition">¶</a></dt>
<dd><p>Scaling factor for maximum grazing rate</p>
</dd></dl>

<dl class="attribute">
<dt id="veros_bgc.core.npzd_tracers.Zooplankton.grazing_saturation_constant">
<code class="descname">grazing_saturation_constant</code><a class="headerlink" href="#veros_bgc.core.npzd_tracers.Zooplankton.grazing_saturation_constant" title="Permalink to this definition">¶</a></dt>
<dd><p>Saturation in Michaelis-Menten</p>
</dd></dl>

<dl class="attribute">
<dt id="veros_bgc.core.npzd_tracers.Zooplankton.grazing_preferences">
<code class="descname">grazing_preferences</code><a class="headerlink" href="#veros_bgc.core.npzd_tracers.Zooplankton.grazing_preferences" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary of preferences for grazing on other tracers</p>
</dd></dl>

<dl class="attribute">
<dt id="veros_bgc.core.npzd_tracers.Zooplankton.assimilation_efficiency">
<code class="descname">assimilation_efficiency</code><a class="headerlink" href="#veros_bgc.core.npzd_tracers.Zooplankton.assimilation_efficiency" title="Permalink to this definition">¶</a></dt>
<dd><p>Fraction of grazed material ingested</p>
</dd></dl>

<dl class="attribute">
<dt id="veros_bgc.core.npzd_tracers.Zooplankton.growth_efficiency">
<code class="descname">growth_efficiency</code><a class="headerlink" href="#veros_bgc.core.npzd_tracers.Zooplankton.growth_efficiency" title="Permalink to this definition">¶</a></dt>
<dd><p>Fraction of ingested material resulting in growth</p>
</dd></dl>

<dl class="attribute">
<dt id="veros_bgc.core.npzd_tracers.Zooplankton.maximum_growth_temperature">
<code class="descname">maximum_growth_temperature</code><a class="headerlink" href="#veros_bgc.core.npzd_tracers.Zooplankton.maximum_growth_temperature" title="Permalink to this definition">¶</a></dt>
<dd><p>Temperature in Celsius where increasing temperature no longer increases grazing</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">+ All attributes held by super class</code></dt>
<dd></dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="extending-tracers">
<h3>Extending tracers<a class="headerlink" href="#extending-tracers" title="Permalink to this headline">¶</a></h3>
<p>The biogeochemistry tracers make use of the object oriented nature of Python to allow easy extensibility.
Tracers which exhibit nearly identical behavior can be created via extension. For example the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Zooplankton</span></code> class overrides the mortality function defined by the <code class="xref py py-class docutils literal notranslate"><span class="pre">Plankton</span></code> class</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Zooplankton</span><span class="p">(</span><span class="n">Plankton</span><span class="p">):</span>

  <span class="c1"># ...</span>

  <span class="nd">@veros_method</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">mortality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vs</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Zooplankton mortality is modelled with a quadratic mortality rate</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mortality_rate</span> <span class="o">*</span> <span class="bp">self</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
<p>By using this approach you only have to focus on the differences between tracers.</p>
</div>
</div>
<div class="section" id="rules">
<h2>Rules<a class="headerlink" href="#rules" title="Permalink to this headline">¶</a></h2>
<p>Creating your tracers as objects does not in itself add any time evolution to the system. You must
also specify the interaction between the tracers. This is done by creating rules. A rule specifies
the flow from one tracer to another. An ecosystem can be defined as a collection of rules each
specifying part of the flow between tracers.</p>
<p>Rules consist of a function describing the interaction, the name of the source tracer and the name
of the sink tracer. The function itself may be used in several rules.
The rule function has access to any variable stored in the Veros object. This includes results of
the methods described in the previous section. An example rule could look like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@veros_method</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">recycling_to_po4</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">sink</span><span class="p">):</span>
  <span class="k">return</span> <span class="p">{</span><span class="n">source</span><span class="p">:</span> <span class="o">-</span><span class="n">vs</span><span class="o">.</span><span class="n">recycled</span><span class="p">[</span><span class="n">source</span><span class="p">],</span> <span class="n">sink</span><span class="p">:</span> <span class="n">vs</span><span class="o">.</span><span class="n">redfield_ratio_PN</span> <span class="o">*</span> <span class="n">vs</span><span class="o">.</span><span class="n">recycled</span><span class="p">[</span><span class="n">source</span><span class="p">]}</span>
</pre></div>
</div>
<p>The function returns a dictionary. The keys of the dictionary must be names of the tracers, which
are affected by the rule. The values are numpy arrays corresponding to the change in the tracer.
The return dictionary is not strictly required to contain two keys. If a rule only represents part
of an interaction, just one key can be included. Any number of entries in the dictionary will be
processed, but a rule is intended to represent a flow between two tracers.
The rule should then be registered with the names of the source and sink to make it available for
use in Veros.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">register_npzd_rule</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="s1">&#39;recycle_phytoplankton_to_po4&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">recycling_to_po4</span><span class="p">,</span> <span class="s1">&#39;phytoplankton&#39;</span><span class="p">,</span> <span class="s1">&#39;po4&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The rule is registered with the Veros object as the first argument followed by a unique name for the rule
and a tuple consisting of the rule function, the name of the source, and the name of the sink. Those
two names will be passed as arguments to the function. The rule name is used for selecting the rule
for activation.
The tuple may also be replaced by a list containing names of other rules. This collection of rules
may later be activated using just the name the list was registered with.</p>
<div class="section" id="optional-arguments">
<h3>Optional arguments<a class="headerlink" href="#optional-arguments" title="Permalink to this headline">¶</a></h3>
<p>Rules can also be registered with optional arguments.</p>
<p>The <code class="xref py py-attr docutils literal notranslate"><span class="pre">label</span></code> argument specifies a displayed
name which is shown in the graph generated by the biogeochemistry diagnostics.</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">boundary</span></code> may take 3 values. ‘SURFACE’, ‘BOTTOM’ or None (default). If ‘SURFACE’ the rule only applies
to the top layer of the grid. ‘BOTTOM’ means the rule only applies to the cells immediately above the
bottom. None means the rule applies to the entire grid.</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">group</span></code> specifies in which of three execution locations the rule will be applied. The ‘PRIMARY’
group is the default group. Rules in this group will be evaluated several times in a loop. The number
of times specified by the ratio between <code class="xref py py-attr docutils literal notranslate"><span class="pre">vs.dt_tracer</span></code> and <code class="xref py py-attr docutils literal notranslate"><span class="pre">vs.dt_bio</span></code>. The result of the
rule will be time stepped and added to the tracer concentrations. The ‘PRE’ group is evaluated once
per tracer time step before the ‘PRIMARY’ loop. The results of these rules are not time stepped before
adding to the result to the relevant tracers. The ‘POST’ group is evaluated once before the ‘PRIMARY’
rules. Time stepping is left out of ‘PRE’ and ‘POST’ rules in order to allow them to clean up or
reuse results from other rules.</p>
</div>
<div class="section" id="difference-between-rules-and-tracer-classes">
<h3>Difference between rules and tracer classes<a class="headerlink" href="#difference-between-rules-and-tracer-classes" title="Permalink to this headline">¶</a></h3>
<p>The difference between rules and classes and their methods is, that the tracer objects themselves do not
modify tracer concentrations. Only the rules should influence the time evolution of the tracers.
The results of the methods may be used in rules.</p>
</div>
</div>
<div class="section" id="activation">
<h2>Activation<a class="headerlink" href="#activation" title="Permalink to this headline">¶</a></h2>
<p>In order to use the created classes and rules. They must be activated. Tracers are activated by register_npzd_data. Rules are activated by adding their names to npzd_selected_rules for example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">detritus</span> <span class="o">=</span> <span class="n">Recyclable_tracer</span><span class="p">(</span><span class="n">vs</span><span class="o">.</span><span class="n">detritus</span><span class="p">,</span> <span class="s1">&#39;detritus&#39;</span><span class="p">,</span>
                             <span class="n">sinking_speed</span><span class="o">=</span><span class="n">dtr_speed</span><span class="p">,</span>
                             <span class="n">recycling_rate</span><span class="o">=</span><span class="n">vs</span><span class="o">.</span><span class="n">remineralization_rate_detritus</span><span class="p">)</span>
<span class="n">register_npzd_data</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">detritus</span><span class="p">)</span>
</pre></div>
</div>
<p>This adds a tracer with the name ‘detritus’ to the model which sinks and a recycling method.</p>
<p>Rules which have been registered with register_npzd_rule are activated by selecting them with
select_npzd_rule. select_npzd_rule accepts rule names. If the name represents a collection of
rules, each rule in the collection is activated.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># activate the npzd_basic_phytoplankton_grazing rule</span>
<span class="n">select_npzd_rule</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="s1">&#39;npzd_basic_phytoplankton_grazing&#39;</span><span class="p">)</span>

<span class="c1"># a list of rules, which have been registered with a single name</span>
<span class="c1"># may be activated collectively from that name</span>

<span class="n">register_npzd_rule</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="s1">&#39;group_npzd_basic&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="s1">&#39;npzd_basic_phytoplankton_grazing&#39;</span><span class="p">,</span>
      <span class="s1">&#39;npzd_basic_phytoplankton_mortality&#39;</span><span class="p">,</span>
      <span class="s1">&#39;npzd_basic_phytoplankton_fast_recycling&#39;</span><span class="p">,</span>
      <span class="s1">&#39;npzd_basic_phytoplankton_primary_production&#39;</span><span class="p">,</span>
      <span class="s1">&#39;npzd_basic_zooplankton_grazing&#39;</span><span class="p">,</span>
      <span class="s1">&#39;npzd_basic_zooplankton_mortality&#39;</span><span class="p">,</span>
      <span class="s1">&#39;npzd_basic_zooplankton_sloppy_feeding&#39;</span><span class="p">,</span>
      <span class="s1">&#39;npzd_basic_detritus_remineralization&#39;</span><span class="p">,</span>
      <span class="s1">&#39;npzd_basic_detritus_grazing&#39;</span><span class="p">,</span>
      <span class="s1">&#39;npzd_basic_detritus_bottom_remineralization&#39;</span>
<span class="p">])</span>

<span class="n">select_npzd_rule</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="s1">&#39;group_npzd_basic&#39;</span><span class="p">)</span>  <span class="c1"># This activates all the rules in the collection</span>
</pre></div>
</div>
<p>The example setup file for biogeochemistry demonstrates how a configuration file can be
used to activate rules.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../reference/setup-gallery.html" class="btn btn-neutral float-right" title="Setup gallery" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="user-guide.html" class="btn btn-neutral float-left" title="Basic usage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2019, The Veros Team, NBI Copenhagen

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>